<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Droopy Hero Picker</title>
  <style>
    body {
      background-color: #0d0d0d;
      color: #fff;
      font-family: "Poppins", sans-serif;
      margin: 0;
      padding: 20px;
      text-align: center;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 10px;
    }

    p {
      color: #aaa;
      margin-bottom: 20px;
    }

    #heroGrid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .hero-card {
      background-color: #1a1a1a;
      border: 2px solid #e62429;
      border-radius: 10px;
      padding: 10px;
      transition: transform 0.2s, box-shadow 0.2s;
      cursor: pointer;
    }

    .hero-card:hover {
      transform: scale(1.05);
      box-shadow: 0 0 10px #e62429;
    }

    .hero-card img {
      width: 100%;
      border-radius: 8px;
      object-fit: cover;
    }

    .hero-name {
      margin-top: 8px;
      font-weight: bold;
      font-size: 0.9rem;
    }

    footer {
      margin-top: 25px;
      color: #888;
      font-size: 0.8rem;
    }

    footer a {
      color: #9146ff;
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h1>Pick Your Marvel Rivals Hero</h1>
  <p>Select your favorite hero to send a request to the streamer!</p>

  <div id="heroGrid"></div>

  <footer>
    Created by <a href="https://twitch.tv/droopy" target="_blank">ðŸŸ£ Droopy</a>
  </footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyASjfLh3w3UQHRy1wvmWwD5ZfaXWjVYTnE",
      authDomain: "marvel-rivals-overlay-7f867.firebaseapp.com",
      databaseURL: "https://marvel-rivals-overlay-7f867-default-rtdb.firebaseio.com",
      projectId: "marvel-rivals-overlay-7f867",
      storageBucket: "marvel-rivals-overlay-7f867.appspot.com",
      messagingSenderId: "1078364810175",
      appId: "1:1078364810175:web:fac410007b70b65e348f0a"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const heroes = [
      "Adam Warlock", "Angela", "Black Panther", "Black Widow", "Blade", "Captain America",
      "Cloak & Dagger", "Doctor Strange", "Emma Frost", "Groot", "Hawkeye", "Hela", "Hulk",
      "Human Torch", "Invisible Woman", "Iron Fist", "Iron Man", "Jeff the Land Shark", "Loki",
      "Luna Snow", "Magik", "Magneto", "Mantis", "Mister Fantastic", "Moon Knight", "Namor",
      "Peni Parker", "Phoenix", "Psylocke", "The Punisher", "The Thing", "Rocket Raccoon",
      "Scarlet Witch", "Squirrel Girl", "Spider-Man", "Star-Lord", "Storm", "Thor", "Ultron",
      "Venom", "Winter Soldier", "Wolverine"
    ];

    const heroGrid = document.getElementById("heroGrid");
    const params = new URLSearchParams(location.search);
    const channelId = params.get("channel") || "demo";

    // Function to load channel settings from Firebase
    async function loadSettings() {
      try {
        const settingsRef = ref(db, `/channels/${channelId}/settings`);
        const snap = await get(settingsRef);
        const data = snap.val();
        const streamlabsUser = data?.streamlabsUser || "droopy2";
        const defaultAmount = data?.defaultAmount || "5";
        renderHeroes(streamlabsUser, defaultAmount);
      } catch (e) {
        console.error("Failed to load settings", e);
        renderHeroes("droopy2", "5");
      }
    }

    function renderHeroes(streamlabsUser, defaultAmount) {
      heroes.forEach(hero => {
        const card = document.createElement("div");
        card.classList.add("hero-card");

        const img = document.createElement("img");
        img.src = `images/${encodeURIComponent(hero)}.png`;
        img.alt = hero;

        const name = document.createElement("div");
        name.classList.add("hero-name");
        name.textContent = hero;

        card.appendChild(img);
        card.appendChild(name);

        card.onclick = () => {
          const message = encodeURIComponent(`I want to request [${hero}]`);
          const url = `https://streamlabs.com/${streamlabsUser}/tip?amount=${defaultAmount}&message=${message}`;
          window.open(url, "_blank");
        };

        heroGrid.appendChild(card);
      });
    }

    loadSettings();
  </script>
</body>
</html>
