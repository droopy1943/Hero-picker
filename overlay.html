<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Marvel Rivals Hero Overlay</title>
<style>
  body {
    margin: 0;
    background: rgba(0,0,0,0);
    overflow: hidden;
  }

  .overlay {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100vh;
  }

  .char-wrapper {
    position: relative;
    display: inline-block;
    width: calc(400px * 1.05);
    height: calc(250px * 1.05);
    margin: 0 auto;
    overflow: visible;
  }

  #charImg {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: contain;
    position: relative;
    z-index: 1;
    transition: all 0.4s ease;
  }

  /* Default placeholder look */
  #charImg.default-placeholder {
    opacity: 0.5;
    filter: grayscale(40%) brightness(0.9);
    transform: scale(0.85);
  }

  #borderImg {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-52%, -52%) rotate(3deg);
    width: 135%;
    height: 138%;
    z-index: 2;
    pointer-events: none;
  }

  #donorText {
    position: absolute;
    bottom: -40px;
    left: 50%;
    transform: translateX(-50%);
    color: white;
    font-family: "Comic Sans MS", sans-serif;
    font-size: 22px;
    text-shadow: 2px 2px 4px #000;
    z-index: 3;
  }
</style>
</head>

<body>
  <div class="overlay">
    <div class="char-wrapper">
      <img id="charImg" alt="Hero Image">
      <img id="borderImg" src="images/comic_border.png" alt="Border Image">
      <div id="donorText"></div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-database.js";

    console.log("üî• Overlay script loaded ‚Äî initializing Firebase...");

    const firebaseConfig = {
      apiKey: "AIzaSyASjfLh3w3UQHRy1wvmWwD5ZfaXWjVYTnE",
      authDomain: "marvel-rivals-overlay-7f867.firebaseapp.com",
      databaseURL: "https://marvel-rivals-overlay-7f867-default-rtdb.firebaseio.com",
      projectId: "marvel-rivals-overlay-7f867",
      storageBucket: "marvel-rivals-overlay-7f867.appspot.com",
      messagingSenderId: "1078364810175",
      appId: "1:1078364810175:web:fac410007b70b65e348f0a"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    console.log("‚úÖ Firebase initialized");

    const params = new URLSearchParams(location.search);
    const channelId = params.get("channel") || "demo";
    console.log("üõ∞Ô∏è Listening for hero updates on channel:", channelId);

    const charImgEl = document.getElementById("charImg");
    const donorTextEl = document.getElementById("donorText");

    const characters = {
      "Adam Warlock": "Adam Warlock.png", "Angela": "Angela.png", "Black Panther": "Black Panther.png",
      "Black Widow": "Black Widow.png", "Blade": "Blade.png", "Captain America": "Captain America.png",
      "Cloak & Dagger": "Cloak & Dagger.png", "Doctor Strange": "Doctor Strange.png", "Emma Frost": "Emma Frost.png",
      "Groot": "Groot.png", "Hawkeye": "Hawkeye.png", "Hela": "Hela.png", "Hulk": "Hulk.png",
      "Human Torch": "Human Torch.png", "Invisible Woman": "Invisible Woman.png", "Iron Fist": "Iron Fist.png",
      "Iron Man": "Iron Man.png", "Jeff the Land Shark": "Jeff the Land Shark.png", "Loki": "Loki.png",
      "Luna Snow": "Luna Snow.png", "Magik": "Magik.png", "Magneto": "Magneto.png", "Mantis": "Mantis.png",
      "Mister Fantastic": "Mister Fantastic.png", "Moon Knight": "Moon Knight.png", "Namor": "Namor.png",
      "Peni Parker": "Peni Parker.png", "Phoenix": "Phoenix.png", "Psylocke": "Psylocke.png",
      "The Punisher": "The Punisher.png", "The Thing": "The Thing.png", "Rocket Raccoon": "Rocket Raccoon.png",
      "Scarlet Witch": "Scarlet Witch.png", "Squirrel Girl": "Squirrel Girl.png", "Spider-Man": "Spider-Man.png",
      "Star-Lord": "Star-Lord.png", "Storm": "Storm.png", "Thor": "Thor.png", "Ultron": "Ultron.png",
      "Venom": "Venom.png", "Winter Soldier": "Winter Soldier.png", "Wolverine": "Wolverine.png"
    };

    // Watch Firebase path for live hero updates
    const path = `/channels/${channelId}/current`;
    console.log("üëÄ Subscribing to:", path);

    onValue(ref(db, path), (snap) => {
      const cur = snap.val();
      console.log("üì° Data received:", cur);

      if (!cur || !cur.hero) {
        console.warn("‚ö†Ô∏è No hero found. Showing default image.");
        charImgEl.src = "images/pickahero.png";
        charImgEl.classList.add("default-placeholder");
        donorTextEl.textContent = "Pick a Hero!";
        return;
      }

      const heroName = cur.hero.trim();
      const donorName = cur.donor || "";
      const imageName = characters[heroName] || "pickahero.png";

      charImgEl.classList.remove("default-placeholder");
      charImgEl.src = `images/${imageName}`;
      donorTextEl.textContent = donorName ? `Requested by ${donorName}` : "";
      console.log(`‚úÖ Displaying hero: ${heroName} ${donorName ? `(requested by ${donorName})` : ""}`);
    }, (error) => {
      console.error("‚ùå Firebase listener error:", error);
    });
  </script>
</body>
</html>
