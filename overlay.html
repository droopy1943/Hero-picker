<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Marvel Rivals Hero Overlay</title>
<style>
  body {
    margin: 0;
    background: rgba(0,0,0,0);
    overflow: hidden;
  }

  .overlay {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100vh;
  }

  .char-wrapper {
    position: relative;
    display: inline-block;
    width: calc(400px * 1.05);
    height: calc(250px * 1.05);
    margin: 0 auto;
    overflow: visible;
  }

  #charImg {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: contain;
    position: relative;
    z-index: 1;
  }

  #borderImg {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-52%, -52%) rotate(3deg);
    width: 135%;
    height: 138%;
    z-index: 2;
    pointer-events: none;
  }

  #donorText {
    position: absolute;
    bottom: -40px;
    left: 50%;
    transform: translateX(-50%);
    color: white;
    font-family: "Comic Sans MS", sans-serif;
    font-size: 22px;
    text-shadow: 2px 2px 4px #000;
    z-index: 3;
  }
</style>
</head>

<body>
  <div class="overlay">
    <div class="char-wrapper">
      <img id="charImg" alt="Hero Image">
      <img id="borderImg" src="images/comic_border.png" alt="Border Image">
      <div id="donorText"></div>
    </div>
  </div>

  <script>
    // Hero name to file map
    const characters = {
  "Adam Warlock": "Adam Warlock.png",
  "Angela": "Angela.png",
  "Black Panther": "Black Panther.png",
  "Black Widow": "Black Widow.png",
  "Blade": "Blade.png",
  "Captain America": "Captain America.png",
  "Cloak & Dagger": "Cloak & Dagger.png",
  "Doctor Strange": "Doctor Strange.png",
  "Emma Frost": "Emma Frost.png",
  "Groot": "Groot.png",
  "Hawkeye": "Hawkeye.png",
  "Hela": "Hela.png",
  "Hulk": "Hulk.png",
  "Human Torch": "Human Torch.png",
  "Invisible Woman": "Invisible Woman.png",
  "Iron Fist": "Iron Fist.png",
  "Iron Man": "Iron Man.png",
  "Jeff the Land Shark": "Jeff the Land Shark.png",
  "Loki": "Loki.png",
  "Luna Snow": "Luna Snow.png",
  "Magik": "Magik.png",
  "Magneto": "Magneto.png",
  "Mantis": "Mantis.png",
  "Mister Fantastic": "Mister Fantastic.png",
  "Moon Knight": "Moon Knight.png",
  "Namor": "Namor.png",
  "Peni Parker": "Peni Parker.png",
  "Phoenix": "Phoenix.png",
  "Psylocke": "Psylocke.png",
  "The Punisher": "The Punisher.png",
  "The Thing": "The Thing.png",
  "Rocket Raccoon": "Rocket Raccoon.png",
  "Scarlet Witch": "Scarlet Witch.png",
  "Squirrel Girl": "Squirrel Girl.png",
  "Spider-Man": "Spider-Man.png",
  "Star-Lord": "Star-Lord.png",
  "Storm": "Storm.png",
  "Thor": "Thor.png",
  "Ultron": "Ultron.png",
  "Venom": "Venom.png",
  "Winter Soldier": "Winter Soldier.png",
  "Wolverine": "Wolverine.png"
};

    const charImgEl = document.getElementById("charImg");
    const donorTextEl = document.getElementById("donorText");
// Common nicknames / aliases mapping
const aliases = {
  "cap": "Captain America",
  "captain": "Captain America",
  "ironman": "Iron Man",
  "tony": "Iron Man",
  "stark": "Iron Man",
  "spidey": "Spider-Man",
  "spiderman": "Spider-Man",
  "peter": "Spider-Man",
  "logan": "Wolverine",
  "wolv": "Wolverine",
  "punisher": "The Punisher",
  "frank": "The Punisher",
  "bucky": "Winter Soldier",
  "soldier": "Winter Soldier",
  "nat": "Black Widow",
  "widow": "Black Widow",
  "hulk": "Hulk",
  "bruce": "Hulk",
  "doc": "Doctor Strange",
  "drstrange": "Doctor Strange",
  "mag": "Magneto",
  "star": "Star-Lord",
  "starlord": "Star-Lord"
};

    function newDonation(heroName, donorName = "") {
  if (!heroName) return;

  // Normalize hero names: lowercase, strip spaces, hyphens, and punctuation
  const normalize = str => str.toLowerCase().replace(/[\s\-\._]/g, "");

  let normalizedHero = normalize(heroName);

  // Check aliases first
  if (aliases[normalizedHero]) {
    normalizedHero = normalize(aliases[normalizedHero]);
  }

  const heroKey = Object.keys(characters).find(
    key => normalize(key) === normalizedHero
  );


  if (heroKey) {
  let fileName = characters[heroKey];

  // Create a bunch of safe fallback variations to test
  const variants = [
  `images/${fileName}`,
  `images/${fileName.charAt(0).toUpperCase() + fileName.slice(1)}`,
  `images/${fileName.toLowerCase()}`,
  `images/${fileName.replace(/_/g, ' ')}`,   // if original uses underscores
  `images/${fileName.replace(/ /g, '_')}`,   // if original uses spaces
  `images/${fileName.replace(/ /g, '')}`,    // remove spaces entirely
  `images/${fileName.replace(/_/g, '')}`,    // remove underscores entirely
  `images/${fileName.replace(/\.png$/i, '.PNG')}` // uppercase .PNG extension
];


  const tryNext = (index = 0) => {
    if (index >= variants.length) {
      console.warn(`❌ Could not load image for "${heroName}"`);
      charImgEl.style.display = "none";
      return;
    }

    const src = variants[index];
    console.log(`Trying: ${src}`);
    charImgEl.src = src;

    charImgEl.onload = () => {
      charImgEl.style.display = "block";
      donorTextEl.textContent = donorName ? `Requested by ${donorName}` : "";
      console.log(`✅ Loaded: ${src}`);
    };

    charImgEl.onerror = () => {
      console.warn(`Failed: ${src}, trying next...`);
      tryNext(index + 1);
    };
  };

  tryNext();
} else {
  console.log("Hero not found:", heroName);
  charImgEl.style.display = "none";
  donorTextEl.textContent = "";
}

}

    window.newDonation = newDonation;
  </script>

  <!-- Firebase listener -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyASjfLh3w3UQHRy1wvmWwD5ZfaXWjVYTnE",  /* ← paste your real key */
      authDomain: "marvel-rivals-overlay-7f867.firebaseapp.com",
      databaseURL: "https://marvel-rivals-overlay-7f867-default-rtdb.firebaseio.com",
      projectId: "marvel-rivals-overlay-7f867",
      storageBucket: "marvel-rivals-overlay-7f867.appspot.com",
      messagingSenderId: "1078364810175",
      appId: "1:1078364810175:web:fac410007b70b65e348f0a"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const params = new URLSearchParams(location.search);
    const channelId = params.get("channel") || "demo";

    const charImgEl = document.getElementById("charImg");
    const donorTextEl = document.getElementById("donorText");

    onValue(ref(db, `/channels/${channelId}/current`), (snap) => {
      const cur = snap.val();
      if (!cur || !cur.hero) return;

      console.log("Now showing:", cur.hero, "by", cur.donor || "Anonymous");
      newDonation(cur.hero.trim(), cur.donor);
    });
  </script>
  <script>
  // Temporary testing helper — lets you manually trigger heroes
  window.testHero = function(heroName) {
    console.log("Testing hero:", heroName);
    newDonation(heroName, "Test");
  };
</script>

</body>
</html>
