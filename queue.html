<!-- üß© STREAMER SETUP CARD ‚Äì place above your queue interface -->
<div class="card" id="setupCard" style="margin-bottom:20px;">
  <h2 style="cursor:pointer;" onclick="toggleSetup()">‚öôÔ∏è Streamer Setup ‚Äì Configure Your Streamlabs & Firebase Info</h2>
  <div id="setupContent" style="display:none; padding-top:10px;">
    <label>Streamlabs Username:
      <input type="text" id="slUser" placeholder="e.g. droopy2">
      <small style="color:#bbb;display:block;margin-top:2px;">
        üëâ Example: if your link is <code>https://streamlabs.com/droopy2/tip</code>, your username is <b>droopy2</b>.
      </small>
    </label>

    <label style="margin-top:10px;">Default Donation Amount ($):
      <input type="number" id="slAmount" placeholder="e.g. 5" min="1">
    </label>

    <label style="margin-top:10px;">Channel ID:
      <input type="text" id="channelId" placeholder="e.g. Droopy">
    </label>

    <button onclick="saveStreamerSetup()">Save Setup</button>
    <button onclick="clearStreamerSetup()" style="background:#555;">Clear Setup</button>

    <div id="viewerLinkBox" style="display:none; margin-top:15px; border-top:1px solid #333; padding-top:10px;">
      <strong>Share this link with your audience:</strong>
      <div style="display:flex; align-items:center; gap:6px; margin-top:6px;">
        <input type="text" id="viewerLink" readonly style="flex:1;padding:6px;border:none;border-radius:4px;background:#222;color:#fff;">
        <button onclick="copyViewerLink()" style="background:#00897b;">Copy</button>
      </div>
    </div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
  import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-database.js";

  // ‚úÖ your Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyASjfLh3w3UQHRy1wvmWwD5ZfaXWjVYTnE",
    authDomain: "marvel-rivals-overlay-7f867.firebaseapp.com",
    databaseURL: "https://marvel-rivals-overlay-7f867-default-rtdb.firebaseio.com",
    projectId: "marvel-rivals-overlay-7f867",
    storageBucket: "marvel-rivals-overlay-7f867.appspot.com",
    messagingSenderId: "1078364810175",
    appId: "1:1078364810175:web:fac410007b70b65e348f0a"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // üí´ toggle collapse
  window.toggleSetup = function() {
    const c = document.getElementById("setupContent");
    c.style.display = c.style.display === "none" ? "block" : "none";
  };

  // üíæ save streamer setup to Firebase + localStorage
  window.saveStreamerSetup = async function() {
    const user = document.getElementById("slUser").value.trim();
    const amount = document.getElementById("slAmount").value.trim();
    const channel = document.getElementById("channelId").value.trim();

    if (!user || !amount || !channel) {
      alert("Please complete all fields before saving!");
      return;
    }

    try {
      await set(ref(db, `/channels/${channel}/settings`), {
        streamlabsUser: user,
        defaultAmount: amount,
        channelId: channel
      });

      localStorage.setItem("streamlabsUser", user);
      localStorage.setItem("defaultAmount", amount);
      localStorage.setItem("channelId", channel);

      const viewerLink = `https://droopy1943.github.io/Hero-picker/?channel=${encodeURIComponent(channel)}`;
      document.getElementById("viewerLink").value = viewerLink;
      document.getElementById("viewerLinkBox").style.display = "block";

      alert(`‚úÖ Setup saved for ${user}! Viewer link generated.`);
    } catch (err) {
      console.error("Error saving setup:", err);
      alert("‚ùå Failed to save setup. Check console for details.");
    }
  };

  // üßπ clear setup
  window.clearStreamerSetup = function() {
    localStorage.removeItem("streamlabsUser");
    localStorage.removeItem("defaultAmount");
    localStorage.removeItem("channelId");

    document.getElementById("slUser").value = "";
    document.getElementById("slAmount").value = "";
    document.getElementById("channelId").value = "";
    document.getElementById("viewerLinkBox").style.display = "none";

    alert("üßπ Setup cleared!");
  };

  // üìã copy viewer link
  window.copyViewerLink = function() {
    const link = document.getElementById("viewerLink");
    link.select();
    link.setSelectionRange(0, 99999);
    navigator.clipboard.writeText(link.value);
    alert("üìé Link copied to clipboard!");
  };

  // üîÑ populate fields from localStorage on load
  window.addEventListener("DOMContentLoaded", async () => {
    const user = localStorage.getItem("streamlabsUser") || "";
    const amount = localStorage.getItem("defaultAmount") || "";
    const channel = localStorage.getItem("channelId") || "";

    if (user) document.getElementById("slUser").value = user;
    if (amount) document.getElementById("slAmount").value = amount;
    if (channel) document.getElementById("channelId").value = channel;

    if (channel) {
      const viewerLink = `https://droopy1943.github.io/Hero-picker/?channel=${encodeURIComponent(channel)}`;
      document.getElementById("viewerLink").value = viewerLink;
      document.getElementById("viewerLinkBox").style.display = "block";
    }
  });
</script>
