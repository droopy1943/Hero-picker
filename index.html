<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pick Your Hero</title>
<style>
  body {
    background: #0b0b0d;
    color: white;
    font-family: 'Comic Sans MS', sans-serif;
    text-align: center;
    padding: 20px;
  }

  h1 {
    color: #ff3b3b;
    text-shadow: 2px 2px 5px #000;
  }

  .hero-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 14px;
    margin-top: 20px;
  }

  .hero-card {
    background: rgba(255,255,255,0.05);
    border: 2px solid #ff3b3b;
    border-radius: 10px;
    padding: 10px;
    transition: transform 0.15s ease, border-color 0.2s;
  }

  .hero-card:hover {
    transform: scale(1.05);
    border-color: #ffd33b;
    cursor: pointer;
  }

  .hero-card img {
    width: 100%;
    border-radius: 6px;
    object-fit: cover;
  }

  .hero-name {
    font-weight: bold;
    margin-top: 6px;
    color: #fff;
    text-shadow: 1px 1px 3px #000;
  }

  footer {
    margin-top: 30px;
    color: #aaa;
    font-size: 14px;
  }

  footer a {
    color: #9146FF;
    text-decoration: none;
  }

  footer a:hover {
    text-decoration: underline;
  }

  .twitch-icon {
    width: 16px;
    vertical-align: middle;
    margin-right: 4px;
  }
</style>
</head>
<body>
  <h1>Pick Your Hero</h1>

  <div id="heroGrid" class="hero-grid"></div>

  <footer>
    <a href="https://twitch.tv/droopy" target="_blank">
      <img class="twitch-icon" src="https://cdn-icons-png.flaticon.com/512/5968/5968819.png" alt="Twitch">
      Created by Droopy
    </a>
  </footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyASjfLh3w3UQHRy1wvmWwD5ZfaXWjVYTnE",
      authDomain: "marvel-rivals-overlay-7f867.firebaseapp.com",
      databaseURL: "https://marvel-rivals-overlay-7f867-default-rtdb.firebaseio.com",
      projectId: "marvel-rivals-overlay-7f867",
      storageBucket: "marvel-rivals-overlay-7f867.appspot.com",
      messagingSenderId: "1078364810175",
      appId: "1:1078364810175:web:fac410007b70b65e348f0a"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const heroes = [
      "Adam Warlock", "Angela", "Black Panther", "Black Widow", "Blade", "Captain America",
      "Cloak & Dagger", "Doctor Strange", "Emma Frost", "Groot", "Hawkeye", "Hela", "Hulk",
      "Human Torch", "Invisible Woman", "Iron Fist", "Iron Man", "Jeff the Land Shark", "Loki",
      "Luna Snow", "Magik", "Magneto", "Mantis", "Mister Fantastic", "Moon Knight", "Namor",
      "Peni Parker", "Phoenix", "Psylocke", "The Punisher", "The Thing", "Rocket Raccoon",
      "Scarlet Witch", "Squirrel Girl", "Spider-Man", "Star-Lord", "Storm", "Thor", "Ultron",
      "Venom", "Winter Soldier", "Wolverine"
    ];

    const heroGrid = document.getElementById("heroGrid");
    const params = new URLSearchParams(location.search);
    const channelId = params.get("channel") || "demo";

    let streamlabsUser = "droopy";  // fallback
    let defaultAmount = 5;          // fallback

    async function loadSettings() {
      const settingsRef = ref(db, `/channels/${channelId}/settings`);
      const snap = await get(settingsRef);
      if (snap.exists()) {
        const data = snap.val();
        if (data.streamlabsUser) streamlabsUser = data.streamlabsUser;
        if (data.defaultAmount) defaultAmount = data.defaultAmount;
      }
      buildGrid();
    }

    function buildGrid() {
      heroGrid.innerHTML = "";
      heroes.forEach(hero => {
        const heroCard = document.createElement("div");
        heroCard.className = "hero-card";
        const safeHero = hero.replace(/&/g, "and");
        heroCard.innerHTML = `
          <img src="images/${safeHero}.png" alt="${hero}">
          <div class="hero-name">${hero}</div>
        `;
        heroCard.onclick = () => {
          const msg = encodeURIComponent(`I want to request ${hero}`);
          const url = `https://streamlabs.com/${streamlabsUser}/tip?amount=${defaultAmount}&message=${msg}`;
          window.open(url, "_blank");
        };
        heroGrid.appendChild(heroCard);
      });
    }

    loadSettings();
  </script>
</body>
</html>
